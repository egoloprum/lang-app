{% extends 'main.html' %}

{% block content %}

  <section class="row" id="quiz-result">
    <h3 class="m-3">Last Attempt: 
      {% if result.score >= result.quiz.required_score %}
        <span>Passed</span>
      {% else %}
        <span>Failed</span>
      {% endif %}
    </h3>
    <p class="text-muted">{{ result.quiz.required_score }}% to pass the quiz</p>
    <p class="text-muted">{{ result.created_at }}</p>

    <!-- left side -->

    <div class="col-3 m-3">
      <h3>{{ quiz.name }}</h3>
      <div>
        {% for question in questions %}
          <label class="form-label">Question {{ forloop.counter }}</label>
          <p class="form-control">{{ question.body }}</p>
          <ul>  
            {% for answer, sel_answer in answers.items %}
              {% if answer.question == question %}
                {% if sel_answer.correct %}
                  <p class="form-control btn btn-info">{{ answer.body }} {{ answer.correct }} / {{ sel_answer.correct }}</p>
                {% else %}
                  <p class="form-control btn">{{ answer.body }} {{ answer.correct }} / {{ sel_answer.correct }}</p>
                {% endif %}
              {% endif %}
            {% endfor %}

            <label class="form-label">Correct Answer</label>

            {% for answer, sel_answer in answers.items %}
              {% if answer.question == question %}
                {% if answer.correct %}
                  <p class="form-control btn btn-success">{{ answer.body }} {{ answer.correct }} / {{ sel_answer.correct }} </p>
                  {{ break }}
                {% endif %}
              {% endif %}
            {% endfor %}

          </ul>
        {% endfor %}
      </div>    
    </div>

    <!-- right side -->

    <div class="col-3 m-3">
      <label class="form-label">Quiz Name</label>
      <p class="form-control">{{ result.quiz.name }}</p>
      <label class="form-label">User</label>
      <p class="form-control">{{ result.user }}</p>
      <label class="form-label">Score</label>
      <p class="form-control">{{ result.score|floatformat:2 }} %</p>
    </div>

    <div class="col-3 m-3">
      <label class="form-label">Average Score</label>
      <p class="form-control">{{ average_score|floatformat:2 }} %</p>
      <label class="form-label">Attempts</label>
      <p class="form-control">{{ results|length }}</p>
    </div>

    <!-- bottom side -->

    <h3 class="m-3">Previous Attempts</h3>
    <div class="row m-3">
      {% for res in results %}
        <div class="col-3 m-3">
          <h4>Attempt: {{ forloop.revcounter }}</h4>
          <label class="form-label">Quiz Name</label>
          <p class="form-control">{{ res.quiz.name }}</p>
          <label class="form-label">User</label>
          <p class="form-control">{{ res.user }}</p>
          <label class="form-label">Score</label>
          <p class="form-control">{{ res.score|floatformat:2 }} %</p>
        </div>

      {% endfor %}
    </div>

    </div>
  </section>

{% endblock %}
